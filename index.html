<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title>JSONBase - Manage 1 MB of JSON Data Available Everywhere</title>
  <meta name="description" content="JSONBase simplifies the management of up to 1 MB of JSON data. Access, edit, and store your JSON data anywhere with ease. Perfect for developers and teams.">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.jsonbase.com/">
  <meta property="og:title" content="JSONBase - Manage 1 MB of JSON Data Available Everywhere">
  <meta property="og:description" content="Simplify JSON data management. Manage up to 1 MB of JSON data from anywhere. Secure, fast, and developer-friendly.">
  <meta property="og:image" content="https://www.jsonbase.com/assets/og-image.png">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://www.jsonbase.com/">
  <meta property="twitter:title" content="JSONBase - Manage 1 MB of JSON Data Available Everywhere">
  <meta property="twitter:description" content="Simplify JSON data management. Manage up to 1 MB of JSON data from anywhere. Secure, fast, and developer-friendly.">
  <meta property="twitter:image" content="https://www.jsonbase.com/assets/twitter-image.png">
  
  <!-- Favicon -->
  <link rel="icon" href="https://www.jsonbase.com/favicon.ico" type="image/x-icon">
  
  <!-- Keywords (Optional for modern SEO but still useful for context) -->
  <meta name="keywords" content="JSONBase, JSON data, manage JSON, online JSON storage, 1 MB JSON, developer tools, data management, SaaS JSON">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://www.jsonbase.com/">

  <!-- Other meta tags -->
  <meta name="author" content="JSONBase Team">
  <meta name="robots" content="index, follow">

  <!-- styles -->
  <link href="style.css" rel="stylesheet" />
  <link href="libs/prism.css" rel="stylesheet" />
</head>
<body>
  <div class="header">
    <div class="profile">
      <img id="user-photo" src="libs/icons8-google.svg" alt="Photo de profil">
    </div>
    <div id="logout" class="logout">
      <a id="google-logout-btn" href="">Se déconnecter</a>
    </div>
  </div> 
  <div class="container">
    <h1>Sample API</h1> 
    <h2>manage 1 mo of <i style="color: red;">JSON</i> data available everywhere.</h2>

    <div class="connect">
      <button id="google-signin-btn" class="google-signin-btn">
        <img src="libs/icons8-google.svg" alt="Google Logo" />
        Se connecter avec Google
      </button>
    </div>

    <button onclick="connectApi()">test</button>

    <!-- API Key Input -->
    <div class="api-key-container">
      <label for="api-key" style="margin-right: 10px;">API Key :</label>
      <input type="text" id="api-key" placeholder="Your current API Key">
      <!-- <button onclick="connectApi()">Connect</button> -->
    </div>

    <!-- Editable Code Area -->
    <div id="editor">
      <div id="size"></div>
      <pre><code contenteditable="true" class="language-json" id="editable-code">p { color: red }</code></pre>
      <div class="serv-messages">
        <span id="m-error"></span>
        <span id="m-success"></span>
      </div>
    </div>

    <div id="editor-example">
      <div id="size-example"></div>
      <pre><code class="language-json" id="example-editable-code"></code></pre>
    </div>

    <!-- Save Button -->
    <button id="save" class="save" onclick="saveCode()">Sauvegarder</button>
    <button id="disconnect" class="save" onclick="quitter()">Se déconnecter</button>
  </div>

  <!-- modals -->
  <div class="modal-overlay" id="modal-yn">
    <div class="modal">
      <h2 id="modal-yn-title"></h2>
      <button class="yes" id="yes-btn">Yes</button>
      <button class="no" id="no-btn">No</button>
    </div>
  </div>

  <!-- js-->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-auth-compat.js"></script>
  <script src="libs/api-queries.js"></script>
  <script src="libs/google.js"></script>
  <script src="libs/prism.js" data-manual></script>
  <script src="page.js"></script>
  <script>
    // mock pour tests.
    const mockSampleId = "32c3707f-4ee4-491a-93a6-9ca6b828014b";
    // const apiUrl = 'http://localhost:3000/sample';
    let loading = false;

    /* -------------- Functions -------------- */

    /**
     * 
     **/
    async function saveCode() {
      const sampleId = document.getElementById("api-key").value;
      const url = `http://localhost:3000/sample/${sampleId}`;

      if (!isValidJSON(code.textContent)) {
        console.error("Invalid json.");
        displayMessage("Invalid json.", 'm-error');
        return;
      }

      const data = { 
        content: JSON.stringify(JSON.parse(code.textContent))
      };
      console.log(data, JSON.stringify(JSON.parse(code.textContent)));

      try {
            const response = await fetch(url, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const result = await response.json();
            displayMessage("Modification effectuée avec succès.", 'm-success');
            console.log("Réponse du serveur :", result);
        } 
        catch (error) {
            displayMessage(error.message, 'm-error');
            console.error("Erreur lors de la requête POST :", error);
        }
    }

    function verifyJson(jsonString) {
      try {
        let cleanData = jsonString.trim();
        cleanData = cleanData.replace(/\\n/g, '').replace(/\\"/g, '"').split('n/').join('');
        // cleanData = JSON.parse(cleanData);

        return cleanData; // JSON.stringify(cleanData, null, 2);
      } 
      catch (e) {
        console.error("Erreur lors du nettoyage du JSON :", e);
        return null; 
      }
    }

    function persistConnection(apiKey) {
      localStorage.setItem('sampleId', apiKey);
      localStorage.setItem('isLogged', true);
    }

    function disconnect() {
      localStorage.clear();
      editor.style.display = 'none';
      this.setSampleId('');
    }

    function isConnected() {
      return localStorage.getItem('isLogged') !== null && 
             localStorage.getItem('sampleId')?.includes('true') !== null;
    }

  </script>
</body>
</html>
